import{_ as F,h as y,o as u,c as r,a as n,F as f,r as k,d as P,t as m,n as v,i as S,v as w,e as I}from "./index-2c3db99f.js";const T=0,b=1,E=2,a=4,c=14,_=2,x="#000033",L="#006633",R="#00FF99",j="#33FFFF",D="#660099",N="#6633CC",z="#666633",O="#6699FF",M="#66FFFF",q="#993300",B="#996666",V="#99CCCC",J="#CC0033",Y="#FF99CC",A="#FFFF66",G="#FF6600",C=[J,O,z,j,A,R,D,Y,V,L,q,G,x,N,M,B],d="cttubes",U={name:"ColorTube",data(){return{size:c,selected:-1,selectColor:null,clickIndex:"-",colors:C,ORDER:a,tubes:[],showTubes:[],gameStatus:0,backupPlayground:[],cnt:0,ts:0,_tsInter:null}},methods:{startTimer(){if(this._tsInter===null){let t=this;this._tsInter=setInterval(s=>{t.ts+=.1},100)}},stopTimer(){this._tsInter&&(clearInterval(this._tsInter),this._tsInter=null)},saveToLS(){let t={tubes:this.tubes,backupPlayground:this.backupPlayground,gameStatus:this.gameStatus,cnt:this.cnt,ts:this.ts};localStorage.setItem(d,JSON.stringify(t))},loadFromLS(){let t=localStorage.getItem(d);if(t)try{let s=JSON.parse(t);return this.tubes=s.tubes,this.backupPlayground=s.backupPlayground,this.gameStatus=s.gameStatus,this.cnt=s.cnt,this.ts=s.ts,s.ts>0&&this.startTimer(),!0}catch{}return!1},initProcess:function(){this.tubes=[],this.showTubes=[],this.backupPlayground=[],this.cnt=0;for(let t=0; t<_; t++)this.tubes.push([]);for(let t=0; t<c-_; t++){let s=[];for(let i=0; i<a; i++)s.push(C[t]);this.tubes.push(s)}this.shuffle(2),this.saveToLS()},init(t){let s=!1;t||(s=this.loadFromLS()),s||this.initProcess(),this.show()},range(t){let s=[];for(let i=0; i<t; i++)s.push(i);return s},clickOne(t){if(this.startTimer(),this.clickIndex=t,this.gameStatus===T&&(this.gameStatus=b),this.gameStatus!==b)return;if(this.selected===-1){this.tubes[t].length>0&&(this.selected=t);return}if(this.selected===t){this.selected=-1;return}if(this.tubes[t].length===a)return;let s=this.tubes[this.selected].slice(-1)[0];if(this.tubes[t].length===0){this.backupData();let o=this.tubes[this.selected].pop();this.tubes[t].push(o),this.selected=-1,this.saveToLS(),this.show(),this.cnt++;return}let i=this.tubes[t].slice(-1)[0];if(s===i){this.backupData();let o=this.tubes[this.selected].pop();this.tubes[t].push(o),this.selected=-1,this.saveToLS(),this.show(),this.cnt++;return}},backupData(){console.log("backup start",this.backupPlayground.length);let t=y(this.tubes);this.backupPlayground.push(t),console.log("backup end",this.backupPlayground.length)},restart(t){if(!confirm("确定重开？"))return;this.clickIndex=-1,this.cnt=0,t&&(this.ts=0),this.gameStatus=b;let i=this.backupPlayground[0];this.backupPlayground=[],this.selected=-1,this.tubes=i,this.saveToLS(),this.show()},giveup(){this.gameStatus===b&&!confirm("确定换一局？ 跟现在不是一局哦！")||(localStorage.removeItem(d),this.gameStatus=T,this.backupPlayground=[],this.selected=-1,this.cnt=0,this.ts=0,this.stopTimer(),this.init(!0),this.shuffle(2),this.saveToLS(),this.show())},goback(){if(console.log("size",this.backupPlayground.length),this.backupPlayground.length===0)return;console.log("goback start",this.backupPlayground.length);let t=this.backupPlayground.pop();this.selected=-1,this.tubes=t,this.saveToLS(),this.show(),console.log("goback end",this.backupPlayground.length)},shuffle(t){if(this.gameStatus!==0)return;t<a*30&&(t=a*30);let s=-1;for(let i=0; i<t; i++){let o=-1;for(; o<0;){let l=Math.floor(Math.random()*c);this.tubes[l].length>0&&l!==s&&(o=l)}let e=-1;for(; e<0;){let l=Math.floor(Math.random()*c);this.tubes[l].length<a&&l!==o&&(e=l)}let h=this.tubes[o].pop();this.tubes[e].push(h)}for(;;){let i=[];for(let e=0; e<c; e++)this.tubes[e].length<a&&this.tubes[e].length>0&&i.push(e);let o=i.length;if(o<2)break;for(let e=0; e<Math.floor(o/2); e++){let h=o-e-1,l=i[e],g=i[h];for(; this.tubes[l].length>0&&this.tubes[g].length<a;)this.tubes[g].push(this.tubes[l].pop())}}for(let i=0,o=_; o<c;)this.tubes[i].length>0&&this.tubes[o].length===0&&(this.tubes[o]=this.tubes[i],this.tubes[i]=[]),this.tubes[i].length===0&&i++,this.tubes[o].length>0&&o++},show(){let t=!0;this.tubes.forEach(function(s){let i=new Set(s);t&=i.size===1&&s.length===a||s.length===0}),this.showTubes=y(this.tubes),this.showTubes.forEach(function(s){s.reverse()}),t&&(this.gameStatus=E,localStorage.removeItem(d),this.stopTimer(),setTimeout(s=>{alert("恭喜获胜！")},200))}},created(){this.init(!1)}},Z={id:"main"},H={class:"box-canvas",id:"playground"},K={id:"tubes"},Q=["onClick"],W={style:{width:"100%",height:"30px"}},X={key:0},$={key:1},tt={class:"tube-color"},st={style:{width:"100%","min-width":"390px","text-align":"center"}},et={style:{"padding-left":"20px",color:"white"}},it={key:1,style:{height:"10px",width:"10px",display:"inline-block","background-color":"white"}},lt={style:{"padding-left":"20px",color:"white"}},ot={style:{display:"flex","justify-content":"center"}};function nt(t, s, i, o, e, h){return u(),r("div",Z,[n("div",H,[n("div",K,[(u(!0),r(f,null,k(e.showTubes,(l, g)=>(u(),r("div",{class:"tube",onClick: p=>h.clickOne(g)},[n("div",W,[e.selected===g?(u(),r("p",X," >_∠ ")):e.selected>=0&&e.showTubes[e.selected][0]===l[0]&&l.length<e.ORDER?(u(),r("p",$," -_-| ")):I("",!0)]),(u(!0),r(f,null,k(h.range(e.ORDER-l.length), p=>(u(),r("div",tt))),256)),(u(!0),r(f,null,k(l,(p, ht)=>(u(),r("div",{class:"tube-color",style:v({background:p})},null,4))),256))],8,Q))),256))]),n("div",st,[n("span",et,[P("Click: "+m(e.clickIndex)+" | ",1),e.selected>=0?(u(),r("span",{key:0,style:v([{background:e.tubes[e.selected].slice(-1)[0]},{height:"10px",width:"10px",display:"inline-block"}])},null,4)):(u(),r("span",it))]),n("span",lt,"Step: "+m(e.cnt)+"/"+m(e.ts.toFixed(1))+"s ",1)]),n("div",ot,[S(n("div",null,[n("button",{onClick:s[0]||(s[0]= l=>h.goback())},"Back"),n("button",{onClick:s[1]||(s[1]= l=>h.giveup())},"New"),n("button",{onClick:s[2]||(s[2]= l=>h.restart(!1))},"RE")],512),[[w,e.gameStatus===1]]),S(n("div",null,[n("button",{onClick:s[3]||(s[3]= l=>h.restart(!0))},"RE"),n("button",{onClick:s[4]||(s[4]= l=>h.giveup())},"New")],512),[[w,e.gameStatus===2]])])])])}const rt=F(U,[["render",nt],["__scopeId","data-v-e5141daa"]]);export{rt as default};
