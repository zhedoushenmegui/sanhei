import{_ as F,j as P,h as y,k as B,b as N,o as h,c as u,a,l as H,t as p,g as S,w as v,e as C,F as I,r as k,d as f,p as O,m as D}from "./index-2c3db99f.js";const x=402,n={prob:{1:800,2:200,3:50,4:13,5:3,"-1":81,"-2":9,"-3":3,[x]:10},gameStatus:{ready:0,running:1,end:2,sys_pause:3},upLimit:9,downLimit:-4,pauseTime:100,scoreFactor:2,scoreFactorLevel:3,curScoreMsg:"",mapSize:7,tempHubNum:3,alertTime:3};function z(e){let s=0;for(let l in e)s+=e[l];let t=Math.floor(Math.random()*s);for(let l in e)if(t-=e[l],t<0)return parseInt(l);return 1}function L(e){return e.join(",")}const E={name:"sanhe1",props:{dim:{type:Number,default:2},size:{type:Number,default:7}},data(){return{EXC:x,forbidLocInfoTime:n.alertTime,gameStatus:n.gameStatus.ready,map:[],rangeLevel:0,cols:[],sandbox:[],now:0,score:0,step:0,tempHub:[],locations:[],best:{number:0,score:0,step:0},settings:{soundPlay:!0},curScoreMsg:"",curTipMsg:"",lsNameMap:"map"+(this.dim>2?this.dim:""),lsNameBest:"best"+(this.dim>2?this.dim:"")}},methods:{init(e){this.curScoreMsg="",this.gameStatus=n.gameStatus.ready,this.score=0,this.step=0,this.cols=[],this.locations=[];for(let s=0; s<this.size; s++)this.cols.push(String.fromCharCode(65+s)),this.sandbox.push([]);for(let s=0; s<this.dim; s++)this.locations.push(0);if(this.initTempHub(),e||this.loadStatus()===null)this.initMap(this.dim,this.size),this.generateNextChess();else if(this.loadStatus(),this.map.length!==this.size&&this.initMap(this.dim,this.size),this.tempHub===void 0&&(this.tempHub=[],this.initTempHub()),this.tempHub.length>n.tempHubNum){let s=[];for(let t=0; t<n.tempHubNum; t++)s.push(this.tempHub[t]);this.tempHub=s}this.changePlane(this.map),this.saveStatus()},readScore(){if(localStorage.getItem(this.lsNameBest)===null)return;let e=localStorage.getItem(this.lsNameBest),s=P(e);this.best=JSON.parse(s)},initTempHub(){this.tempHub=[];for(let e=0; e<n.tempHubNum; e++)this.tempHub.push(0)},generateMap(e, s, t, l){if(e===t){let i=y(n.prob);i[0]=i[1]*2,i[x]=0;let o=z(i);return this.updateBest(o),{val:o,loc:s}}else{let i=[];for(let o=0; o<l; o++){let r=y(s);r.push(o),i[o]=this.generateMap(e+1,r,t,l)}return i}},initMap(e, s){this.map=this.generateMap(0,[],e,s),this.changePlane(this.map)},onPut(e){if(this.gameStatus===n.gameStatus.end)if(confirm("重新开始?"))this.init(!0);else return;if(this.now===x){if(e.val===0)return;this.now=e.val,e.val=0}else{if(this.gameStatus=n.gameStatus.running,e.val!==0)return;this.step++,this.chessIn(e.loc),this.updateBest(e.val)}this.genTipMsg()},countScore(e, s){let t=s-3,l=5+n.scoreFactor*(s-3)+n.scoreFactorLevel*this.rangeLevel;e<0&&(e*=-1);let i=l*e;return this.score+=i,"(基础倍率{0} + 连续倍率{1} * 连续数量{2} + 连升奖励{3} * 连升数量{4}) x 元素分{5}={6}".format(5,n.scoreFactor,t,n.scoreFactorLevel,this.rangeLevel,e,i)},chessNextLevel(e){return e<0?e--:e++,e>n.upLimit||e<n.downLimit?0:e},generateNextChess(){let e=y(n.prob);this.now=z(e)},chessIn(e){this.curScoreMsg="",this.rangeLevel=0;let s=y(this.now);this.generateNextChess(),this.setTargetChess(e,s),this.changePlane(this.map),this.gameStatus=n.gameStatus.sys_pause;let t=this;for(setTimeout(function(){t.gameStatus=n.gameStatus.running,t.checkAlive()||(t.gameStatus=n.gameStatus.end,alert("游戏结束!"))},20),this.curScoreMsg="";;){let l=this.getTargetChess(e),i=this.chessInProcess(e,l),o=i.length;if(o<3)break;for(let b=0; b<o; b++)this.setTargetChess(i[b],0);let r=this.countScore(l,o);this.curScoreMsg+=r+";";let _=this.chessNextLevel(l);this.setTargetChess(e,_),this.rangeLevel++,this.updateBest(_)}this.changePlane(this.map),this.genTipMsg()},changePlane(e){let s=this.locations,t=e;for(let l=0,i=s.length-this.dim; l<i; l++)t=t[s[l]];this.sandbox=t},onChangePlane(e, s){let t=this.locations[e];s?t++:t--,this.locations[e]=(t+n.mapSize*10)%n.mapSize,this.changePlane(this.map)},chessInProcess(e, s){let t={},l=L(e);t[l]=e;let i={},o={};for(o[l]=e;;){for(let b in o){let c=o[b];if(delete o[b],this.getTargetChess(c)===s){let M=L(c);i[M]=c;for(let m=0; m<this.dim; m++){let g=c[m]-1,w=c[m]+1;if(g>=0&&g<this.size){let d=y(c);d[m]=g;let T=L(d);t[T]===void 0&&(t[T]=d,o[T]=d)}if(w>=0&&w<this.size){let d=y(c);d[m]=w;let T=L(d);t[T]===void 0&&(t[T]=d,o[T]=d)}}}}let _=0;for(let b in o)_++;if(_<1)break}let r=[];for(let _ in i)r.push(i[_]);return r},checkAlive(){this.saveStatus();let e=!1;function s(t){if(!e)if(t.val===void 0){for(let l=0,i=t.length; l<i; l++)if(s(t[l]),e)return}else t.val===0&&(e=!0)}return s(this.map),e},setTargetChess(e, s){let t=this.map,l=e.length;console.log(e,this.dim);for(let r=0; r<l-this.dim; r++)t=t[e[r]];let i=e[l-2],o=e[l-1];t[i][o].val=s},getTargetChess(e){let s=y(this.map);e.length!==this.dim&&alert("系统bug!建议刷新重试");for(let t=0,l=e.length; t<l; t++)s=s[e[t]];return s.val},swapTempHub(e){let s=this.tempHub[e];this.tempHub[e]=this.now,s===0?this.generateNextChess():this.now=s,this.saveStatus(),this.genTipMsg()},changeDim(e){this.gameStatus===n.gameStatus.running&&!confirm("将重新开始, 确认?")||(this.dim=e,this.init(!0))},changeSoundState(){this.settings.soundPlay=!this.settings.soundPlay,this.saveStatus()},saveStatus(){let e={map:this.map,next:this.now,score:this.score,step:this.step,tempHub:this.tempHub,settings:this.settings,forbidLocInfoTime:this.forbidLocInfoTime,gameStatus:this.gameStatus},s=JSON.stringify(e),t=B(s);return localStorage.setItem(this.lsNameMap,t),localStorage.getItem(this.lsNameMap)===null},loadStatus(){if(localStorage.getItem(this.lsNameMap)===null)return null;let e=localStorage.getItem(this.lsNameMap),s=P(e),t=JSON.parse(s);this.map=t.map,this.now=t.next,this.score=t.score,this.step=t.step,this.tempHub=t.tempHub,this.settings=t.settings,t.forbidLocInfoTime!==void 0?this.forbidLocInfoTime=t.forbidLocInfoTime:this.forbidLocInfoTime=1,t.gameStatus!==void 0?this.gameStatus=t.gameStatus:this.gameStatus=n.gameStatus.running},updateBest(e){this.step>this.best.step&&(this.best.step=this.step),this.score>this.best.score&&(this.best.score=this.score),e>this.best.number&&(this.best.number=e);let s=JSON.stringify(this.best),t=B(s);localStorage.setItem(this.lsNameBest,t)},genTipMsg(){this.curTipMsg="",this.now===x&&(this.curTipMsg="小吊车可以提取地图上元素,并任意放置."),this.now===-1&&(this.curTipMsg="小兔子咕叽咕叽就来了."),this.now===-2&&(this.curTipMsg="小兔子带来了玩具."),this.now===-3&&(this.curTipMsg="小兔子在玩什么游戏呢？"),this.now===1&&(this.curTipMsg="四叶草代表幸运"),this.now===2&&(this.curTipMsg="胡萝卜为伞形科胡萝卜属"),this.now===3&&(this.curTipMsg="胡萝卜为什么变成了大树呢?"),this.now===4&&(this.curTipMsg="这棵大树是从戴夫后花园里搬来的"),this.now===5&&(this.curTipMsg="幸运得没边了!")}},mounted(){this.readScore(),this.init(!1),this.genTipMsg()}},j= e=>(O("data-v-595b687b"),e=e(),D(),e),J={id:"content",class:"col-xs-12 col-sm-12 col-md-6 col-lg-4 col-md-offset-3 col-lg-offset-4"},V=j(()=>a("div",{style:{height:"1rem",width:"100%"}},null,-1)),A={id:"head"},X={style:{display:"flex","justify-content":"space-evenly","align-items":"center"}},K={class:"pot-val"},q={key:0,class:"col-xs-12 col-sm-12 col-md-12 col-lg-12 panel"},G=j(()=>a("p",null,null,-1)),Q={id:"playground"},R={id:"tbody"},U=["onClick"],W={key:0,class:"pot-val"},Y={key:1,class:"pot-val-show"},Z={key:0,class:"col-xs-12 col-sm-12 col-md-12 col-lg-12 panel temp-hub"},$=["onClick"],ee={class:"pot-val"},te={key:1,class:"col-xs-12 col-sm-12 col-md-12 col-lg-12 panel"},se={class:"score-panel",id:"scoreMsg"},ie={class:"col-xs-12 col-sm-12 col-md-12 col-lg-12 panel",id:"scorePanel"},le={class:"score-panel"},oe={class:"col-xs-12 col-sm-12 col-md-12 col-lg-12 panel"},ne={class:"score-panel"};function ae(e, s, t, l, i, o){const r=N("el-button"),_=N("InfoFilled"),b=N("el-icon"),c=N("el-tag");return h(),u("div",J,[V,a("div",A,[a("div",X,[a("div",null,[a("span",{class:H(["pot","cl"+i.now]),style:{width:"40px",height:"40px"}},[a("span",K,p(i.now),1)],2)]),S(r,{class:"btn button dim button-border button-rounded button-primary",onClick:s[0]||(s[0]= M=>o.changeDim(2))},{default:v(()=>[f(" 重新开始 ")]),_:1})]),i.curTipMsg?(h(),u("div",q,[S(c,{class:"tips"},{default:v(()=>[S(b,null,{default:v(()=>[S(_)]),_:1}),f(" "+p(i.curTipMsg),1)]),_:1}),G])):C("",!0)]),a("div",Q,[a("div",R,[(h(!0),u(I,null,k(i.sandbox,(M, m)=>(h(),u("div",{class:"line",key:m},[(h(!0),u(I,null,k(M,(g, w)=>(h(),u("span",{class:H(["pot","cl"+g.val]),key:w,onClick: d=>o.onPut(g)},[g.val!==0?(h(),u("span",W,p(g.val),1)):t.dim>2?(h(),u("span",Y,p(g.loc.join(",")),1)):C("",!0)],10,U))),128))]))),128))])]),i.tempHub.length>0?(h(),u("div",Z,[a("div",null,[f(" 暂存区: "),(h(!0),u(I,null,k(i.tempHub,(M, m)=>(h(),u("div",{key:m,class:H(["pot","cl"+M]),onClick: g=>o.swapTempHub(m)},[a("span",ee,p(M),1)],10,$))),128))])])):C("",!0),i.curScoreMsg?(h(),u("div",te,[a("p",se," 得分: "+p(i.curScoreMsg),1)])):C("",!0),a("div",ie,[a("p",le,[f(" 本局成绩: "),S(c,{class:"col-xs-4 col-sm-4 col-md-4 col-lg-4"},{default:v(()=>[f("得分:"+p(i.score),1)]),_:1}),S(c,{type:"success",class:"col-xs-4 col-sm-4 col-md-4 col-lg-4"},{default:v(()=>[f("步数:"+p(i.step),1)]),_:1})])]),a("div",oe,[a("p",ne,[f(" 最好成绩: "),S(c,{class:"col-xs-4 col-sm-4 col-md-4 col-lg-4"},{default:v(()=>[f("得分:"+p(i.best.score),1)]),_:1}),S(c,{type:"success",class:"col-xs-4 col-sm-4 col-md-4 col-lg-4"},{default:v(()=>[f("步数:"+p(i.best.step),1)]),_:1}),S(c,{type:"warning",class:"col-xs-4 col-sm-4 col-md-4 col-lg-4"},{default:v(()=>[f("数字:"+p(i.best.number),1)]),_:1})])])])}const re=F(E,[["render",ae],["__scopeId","data-v-595b687b"]]);export{re as default};
